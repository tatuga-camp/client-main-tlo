!function(){"use strict";let e;var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),o=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),a=tinymce.util.Tools.resolve("tinymce.util.Tools");let n=e=>{(0,e.options.register)("allow_html_in_named_anchor",{processor:"boolean",default:!1})},r=(e="allow_html_in_named_anchor",t=>t.options.get(e)),l="a:not([href])",i=e=>!e,d=e=>e.getAttribute("id")||e.getAttribute("name")||"",s=e=>"a"===e.nodeName.toLowerCase(),c=e=>s(e)&&!e.getAttribute("href")&&""!==d(e),m=e=>c(e)&&!e.firstChild,u=e=>{let t=e.dom;o(t).walk(e.selection.getRng(),e=>{a.each(e,e=>{m(e)&&t.remove(e,!1)})})},h=e=>/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(e),g=e=>e.dom.getParent(e.selection.getStart(),l),p=e=>{let t=g(e);return t?d(t):""},b=(e,t)=>{e.undoManager.transact(()=>{r(e)||e.selection.collapse(!0),e.selection.isCollapsed()?e.insertContent(e.dom.createHTML("a",{id:t})):(u(e),e.formatter.remove("namedAnchor",void 0,void 0,!0),e.formatter.apply("namedAnchor",{value:t}),e.addVisual())})},f=(e,t,o)=>{o.removeAttribute("name"),o.id=t,e.addVisual(),e.undoManager.add()},y=(e,t)=>{let o=g(e);o?f(e,t,o):b(e,t),e.focus()},v=(e,t)=>h(t)?(y(e,t),!0):(e.windowManager.alert("ID should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),!1),A=e=>{let t=p(e);e.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:t},onSubmit:t=>{v(e,t.getData().id)&&t.close()}})},C=e=>{e.addCommand("mceAnchor",()=>{A(e)})},w=e=>i(e.attr("href"))&&!i(e.attr("id")||e.attr("name")),_=e=>w(e)&&!e.firstChild,M=e=>t=>{for(let o=0;o<t.length;o++){let a=t[o];_(a)&&a.attr("contenteditable",e)}},T=e=>{e.on("PreInit",()=>{e.parser.addNodeFilter("a",M("false")),e.serializer.addNodeFilter("a",M(null))})},k=e=>{e.formatter.register("namedAnchor",{inline:"a",selector:l,remove:"all",split:!0,deep:!0,attributes:{id:"%value"},onmatch:(e,t,o)=>c(e)})},x=e=>t=>{let o=()=>{t.setEnabled(e.selection.isEditable())};return e.on("NodeChange",o),o(),()=>{e.off("NodeChange",o)}},I=e=>{let t=()=>e.execCommand("mceAnchor");e.ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:t,onSetup:t=>{let o=e.selection.selectorChangedWithUnbind("a:not([href])",t.setActive).unbind,a=x(e)(t);return()=>{o(),a()}}}),e.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:t,onSetup:x(e)})};t.add("anchor",e=>{n(e),T(e),C(e),I(e),e.on("PreInit",()=>{k(e)})})}();